@{
    ViewBag.Title = "WritingGame";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@Styles.Render("~/Content/css")
@Styles.Render("~/Library/css/guessingGame.css")
<!-- Modal -->
<div class="modal fade" id="myModal" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Nhập số lượng từ từ 1 đến <span id="countWord"></span></h4>
            </div>
            <div class="modal-body">
                <input type="hidden" id="hiddenNumber" value="@ViewBag.CountWord" />
                <input type="number" min="1" max=@ViewBag.CountWord  id="numberWord" />
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" id="submitButton">Go</button>
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>

    </div>
</div>


<article id="webslides" class="vertical">
        <section class="bg-white" style="background-image:url('https://cntttest.vanlanguni.edu.vn:18081/SpeakOut/Library/images/game.jpg')">
            <!--Body is here-->
            <!-- multistep form -->
            <form id="msform">
                <!-- progressbar -->
                <ul id="progressbar"></ul>
                <div id="listQuestion">
                </div>
            </form>
        </section>
</article>
@section Scripts {
    <!-- jQuery -->
    <!--<script src="~/Library/js/guessingGame.js"></script>-->
    <!-- jQuery easing plugin -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.3/jquery.easing.min.js" type="text/javascript"></script>
}
@section Script1{
    <script>
        function slidingWord() {
            //jQuery time
            var current_fs, next_fs, previous_fs; //fieldsets
            var left, opacity, scale; //fieldset properties which we will animate
            var animating; //flag to prevent quick multi-click glitches

            $(".next").click(function () {
                if (animating) return false;
                animating = true;

                current_fs = $(this).parent();
                next_fs = $(this).parent().next();

                //activate next step on progressbar using the index of next_fs
                $("#progressbar li").eq($("fieldset").index(next_fs)).addClass("active");

                //show the next fieldset
                next_fs.show();
                //hide the current fieldset with style
                current_fs.animate({ opacity: 0 }, {
                    step: function (now, mx) {
                        //as the opacity of current_fs reduces to 0 - stored in "now"
                        //1. scale current_fs down to 80%
                        scale = 1 - (1 - now) * 0.2;
                        //2. bring next_fs from the right(50%)
                        left = (now * 50) + "%";
                        //3. increase opacity of next_fs to 1 as it moves in
                        opacity = 1 - now;
                        current_fs.css({ 'transform': 'scale(' + scale + ')' });
                        next_fs.css({ 'left': left, 'opacity': opacity });
                    },
                    duration: 500,
                    complete: function () {
                        current_fs.hide();
                        animating = false;
                    },
                    //this comes from the custom easing plugin
                    easing: 'easeOutQuint'
                });
            });

            $(".previous").click(function () {
                if (animating) return false;
                animating = true;

                current_fs = $(this).parent();
                previous_fs = $(this).parent().prev();

                //de-activate current step on progressbar
                $("#progressbar li").eq($("fieldset").index(current_fs)).removeClass("active");

                //show the previous fieldset
                previous_fs.show();
                //hide the current fieldset with style
                current_fs.animate({ opacity: 0 }, {
                    step: function (now, mx) {
                        //as the opacity of current_fs reduces to 0 - stored in "now"
                        //1. scale previous_fs from 80% to 100%
                        scale = 0.8 + (1 - now) * 0.2;
                        //2. take current_fs to the right(50%) - from 0%
                        left = ((1 - now) * 50) + "%";
                        //3. increase opacity of previous_fs to 1 as it moves in
                        opacity = 1 - now;
                        current_fs.css({ 'left': left });
                        previous_fs.css({ 'transform': 'scale(' + scale + ')', 'opacity': opacity });
                    },
                    duration: 500,
                    complete: function () {
                        current_fs.hide();
                        animating = false;
                    },
                    //this comes from the custom easing plugin
                    easing: 'easeOutQuint'
                });
            });

            $(".submit").click(function () {
                return false;
            })
        }
        var mangTraVeTiengAnh = [];
        var mangTraVeTiengViet = [];
        var mangTraVeDanhVan = [];
        $(document).ready(function () {
            $.ajax({
                type: "GET",
                url: '@Url.Action("../Game/GetListCard")',
                data: { number: localStorage.getItem("numberWord") },
                dataType: "json",
                success: function (response) {
                    console.log(response);
                    if (response != "Không tìm thấy từ điển") {
                        $.each(response, function (i, item) {
                            mangTraVeTiengAnh.push(item.EngWord);
                            mangTraVeTiengViet.push(item.VnWord);
                            mangTraVeDanhVan.push(item.Spelling);
                        });
                        $('#progressbar').append('<li class="active"></li>');
                        for (let i = 0; i < mangTraVeTiengAnh.length - 1; i++) {
                            $("#progressbar").append('<li></li>');
                        }

                        for (let i = 0; i < mangTraVeTiengAnh.length; i++) {
                            var increment = i + 1;
                            if (increment == 1) {
                                $("#listQuestion").append('<fieldset>' +
                                    '<h2 class="fs-title">Question' + increment + '</h2>' +
                                    '<h3 class="fs-subtitle">' + mangTraVeDanhVan[i] + '</br>' + mangTraVeTiengViet[i] + '</h3>' +
                                    '<input  type="text" data-meaning="' + mangTraVeTiengAnh[i] + '" class="currentQuestion" name="CAT_Custom_' + increment + '" id="CAT_Custom_' + increment + '" rows="4" onkeydown="if (this.value.length >= 4000) this.value = this.value.substring(0, 3999); ">' +
                                    '<input type="button" name="next" class="next action-button" value="Next" />' +
                                    '</fieldset>');
                            } else if (increment == mangTraVeTiengAnh.length) {
                                $("#listQuestion").append('<fieldset>' +
                                    '<h2 class="fs-title">Question' + increment + '</h2>' +
                                    '<h3 class="fs-subtitle">' + mangTraVeDanhVan[i] + '</br>' + mangTraVeTiengViet[i] + '</h3>' +
                                    '<input  type="text" data-meaning="' + mangTraVeTiengAnh[i] + '" class="currentQuestion" name="CAT_Custom_' + increment + '" id="CAT_Custom_' + increment + '" rows="4" onkeydown="if (this.value.length >= 4000) this.value = this.value.substring(0, 3999); ">' +
                                    '<input type="button" name="previous" class="previous action-button" value="Previous" />' +
                                    '<button type = "button" name = "submit" class= "submit action-button" id="restartButton"  data-toggle="modal" data-target="#myModal">Restart</button>' +
                                    '</fieldset>');
                            } else {
                                $("#listQuestion").append('<fieldset>' +
                                    '<h2 class="fs-title">Question' + increment + '</h2>' +
                                    '<h3 class="fs-subtitle">' + mangTraVeDanhVan[i] + '</br>' + mangTraVeTiengViet[i] + '</h3>' +
                                    '<input  type="text" data-meaning="' + mangTraVeTiengAnh[i] + '" class="currentQuestion" name="CAT_Custom_' + increment + '" id="CAT_Custom_' + increment + '" rows="4" onkeydown="if (this.value.length >= 4000) this.value = this.value.substring(0, 3999); ">' +
                                    '<input type="button" name="previous" class="previous action-button" value="Previous" />' +
                                    '<input type="button" name="next" class="next action-button" value="Next" />' +
                                    '</fieldset>');
                            }
                        }
                    }
                    slidingWord();
                    $('.currentQuestion').on('keyup', function () {
                        if ($(this).attr('data-meaning') == $(this).val()) {
                            $(this).attr("disabled", true).css("background-color", "#5cb85c");
                        } else {
                            $(this).attr("disabled", false).css("background-color", "#d9534f");
                        }
                    });
                    $("#countWord").text(localStorage.getItem("personalWord"));
                    //Validate type on input
                    $("[type='number']").attr({
                        "max": localStorage.getItem("personalWord"),        // substitute your own
                        "min" : 2  
                    });
                    $("[type='number']").keypress(function (evt) {
                        evt.preventDefault();
                    });
                    $('#submitButton').click(function () {
                        localStorage.setItem("numberWord", $("[type='number']").val());
                        window.location.href = "../Game/WritingGame";
                    });
                    $('#restartButton').click(function () {
                        $('#myModal').modal('toggle');
                    });
                },
                error: function (xhr, status, error) {
                    alert('Result: ' + status + ' ' + error + ' ' + xhr.status + ' ' + xhr.statusText)
                }
            });
        });
    </script>
}